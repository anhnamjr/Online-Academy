<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
      integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/css/index.css" />
    <link rel="stylesheet" href="/css/instructor.css" />
    <title>
      Online Courses - Learn Anything On Your Schedule | MNP Courses
    </title>
    <link rel="shortcut icon" href="/assets/images/logo-images.svg" />
    <!-- Main Quill library -->
    <script src="//cdn.quilljs.com/1.0.0/quill.js"></script>
    <script src="//cdn.quilljs.com/1.0.0/quill.min.js"></script>

    <!-- Theme included stylesheets -->
    <link href="//cdn.quilljs.com/1.0.0/quill.snow.css" rel="stylesheet">
    <link href="//cdn.quilljs.com/1.0.0/quill.bubble.css" rel="stylesheet">

  </head>
  <body>
    <!-- Header -->
    <nav class="navbar navbar-expand-md navbar-light bg-light sticky-top">
      <div class="container">
        <a href="#" class="navbar-branch">
          <img src="/assets/images/logo.svg" width="160px" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarResponsive"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <form id="formSearch" class="ml-1">
            <span><i class="fas fa-search"></i></span>
            <input type="text" placeholder="Search..." class="rounded-pill" />
          </form>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link" href="#">Home</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="dropdownCategory"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
                >Categories</a
              >
              <div class="dropdown-menu" aria-labelledby="dropdownCategory">
                <a class="dropdown-item" href="#">Mobile</a>
                <a class="dropdown-item" href="#">web</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">About</a>
            </li>
            <% if(typeof user !== 'undefined' ) { %>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="fas fa-shopping-cart"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="fa fa-heart" aria-hidden="true"></i>
              </a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="dropdownUser"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
                ><%= user.username %></a
              >
              <div class="dropdown-menu" aria-labelledby="dropdownUser">
                <a class="dropdown-item" href="#">My Profile</a>
                <a class="dropdown-item" href="#">Log out</a>
              </div>
            </li>
            <% } else { %>
            <li class="nav-item">
              <a class="nav-link" href="#"> Login </a>
            </li>
            <% } %>
          </ul>
        </div>
      </div>
    </nav>

		<!-- Courses -->
    <div class="container mt-5 mb-5">
      <form action="/instructor/addCourse?id=<%=course.id%>" method="post" enctype="multipart/form-data">
          <div class="form-group">
            <label for="courseName">Course name</label>
            <input type="text" class="form-control" id="courseName"  name="courseName" value="<%=course.course_name%>" >
          </div>
          <div id="courseImagediv" class="form-group">
            <label for="courseImage">Course image</label>
						<div id="img-container" >
							<img id = "image" src=<%=course.img_path%> alt="Image">
						</div>
						<input type="file" class="form-control-file" id="courseImage" name = "image" onchange="readURL(this);">
          </div>
          <div class="form-group">
						<label for="category">Category</label>

            <select class="form-control" id="category" name="category">
							<option value="none" selected disabled hidden> 
								<%=course.Category.category_name%> 
							</option>
              <% for(let i=0;i<category.length;i++) {%>
              	<option><%=category[i].category_name%></option>
              <%}%>
            </select>
          </div>
          
          <div class="form-group">
            <label for="shortDescription">Short description</label>
            <textarea  autofocus style="margin:0; padding:0"  cols="20" class="form-control" id="shortDescription" rows="3" name = "shortDescription" ><%=course.short_description %></textarea>
          </div>
          <div class="form-group">
            <label for="fdcontent">Full description</label>
            <!-- Create the editor container -->
            <div id="editor" class="form-control" ></div>
            <input type="text" id="fdcontent" name='fullDescription' hidden>

          </div>
          <div class="form-group">
						<label for="price">Price</label>
						<input type="number" class="form-control" id="price"  name = "price" value = "<%=course.price%>">
          </div>
          <div class="form-group">
            <label for="concurency">Concurency</label>
            <input type="text" class="form-control" id="concurency" name = "concurency" value = "<%=course.concurrency%>">
					</div>
          <div class="form-group">
            <label for="language">Language</label>
            <input type="text" class="form-control" id="language" name = "language" value = "<%=course.course_language%>">
					</div>
					<div class="center">
						<input type="submit" class ="btn btn-primary" value="Save"/>
					</div>
			</form>

				<!-- Course content -->
				<div class="course-content">
					<div class="course-content-title">
						Course Content
          </div>
          <div class="accordion" id="accordionExample">
          <%for(i=0;i<course.Chapters.length;i++) {%>
					<div class="card">
						<div class="card-header" id="<%=course.Chapters[i].id%>">
							<h2 class="mb-0">
								<button class="btn  btn-block text-left" type="button" data-toggle="collapse" data-target="#collap_<%=course.Chapters[i].id%>" aria-expanded="true" aria-controls="collap_<%=course.Chapters[i].id%>">
									Chapter <%=i%>: <%=course.Chapters[i].short_description%>
								</button>
							</h2>
						</div>
						<div id="collap_<%=course.Chapters[i].id%>" class="collapse show" aria-labelledby="<%=course.Chapters[i].id%>" data-parent="#accordionExample">
              <div class="card-body">
                <ul class="list-group">
                  <%for(j=0;j<course.Chapters[i].Lessons.length;j++) {%>
									<li class="list-group-item"><%=course.Chapters[i].Lessons[j].lesson_name%></li>
									<!-- <li class="list-group-item">Course Curriculum Overview</li> -->
                  <%}%>
                  <li class="list-group-item">
                    <button id="add-lesson-btn" type="button" class="btn btn-primary" onClick="window.open('/instructor/addLesson?chapter_id=<%=course.Chapters[i].id%>');" >Add Lesson</button>
                  </li>
								</ul>
							</div>
            </div>
            
          </div>
          <%}%>
				</div>
				</div>
				<div class="form-group">
					<button id="add-chapter-btn" class="btn btn-primary" onClick="window.open('/instructor/addChapter?course_id=<%=course.id%>');" >Add Chapter</button>
        </div>

    </div>
    <!-- Footer -->
    <div class="container-fluid footer">
      <div class="row">
        <ul class="col list-group">
          <li class="list-group"><a href="#"> MNP for Business</a></li>
          <li class="list-group"><a href="#"> Teach on Udemy</a></li>
          <li class="list-group"><a href="#"> About us</a></li>
          <li class="list-group"><a href="#"> Contact us</a></li>
        </ul>
        <ul class="col list-group">
          <li class="list-group"><a href="#"> Careers</a></li>
          <li class="list-group"><a href="#"> Blog</a></li>
          <li class="list-group"><a href="#"> Help and Support</a></li>
          <li class="list-group"><a href="#"> Affiliate</a></li>
        </ul>
        <ul class="col list-group">
          <li class="list-group"><a href="#"> Terms</a></li>
          <li class="list-group">
            <a href="#"> Privacy policy and cookie policy</a>
          </li>
          <li class="list-group"><a href="#"> Sitemap</a></li>
          <li class="list-group"><a href="#"> Featured courses</a></li>
        </ul>
      </div>
      <div class="row footer-logo d-flex justify-content-between">
        <div>
          <img src="/assets/images/logo-images.svg" width="50px" />
        </div>
        <div class="mt-3">Copyright @ 2020 MNP, Inc</div>
      </div>
    </div>

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
		<script>
			function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#image')
                    .attr('src', e.target.result)
                    .width('60%')
                    .height('60%');
            };

            reader.readAsDataURL(input.files[0]);
        }
			}
    </script>

    <% if (course) { %>

     <script>
      let content = <%- course.full_description?course.full_description.replace('&#34;','"'):'""'%>;            

      let toolbarOptions = [
        ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
        ['blockquote', 'code-block'],

        [{ 'header': 1 }, { 'header': 2 }],               // custom button values
        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
        [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript
        [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent
        [{ 'direction': 'rtl' }],                         // text direction

        [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

        [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
        [{ 'font': [] }],
        [{ 'align': [] }],

        ['clean']                                         // remove formatting button
      ];

      var editor = new Quill('#editor', { 
        modules: { toolbar: toolbarOptions },
        theme: 'snow'
      });
      //load content from db
      editor.setContents(content);

      let delta = JSON.stringify(editor.getContents()).replace('\"','"')
      document.getElementById('fdcontent').value = delta
      
      editor.on('text-change', function() {
        let delta = JSON.stringify(editor.getContents()).replace('\"','"')
        document.getElementById('fdcontent').value = delta
      }); 

    </script>
    <% } %>
     <!-- Initialize Quill editor -->

  </body>
</html>
